<!DOCTYPE html>
<!--[if IE 6]>
<html id="ie6" lang="en-US">
<![endif]-->
<!--[if IE 7]>
<html id="ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html id="ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 6) | !(IE 7) | !(IE 8)  ]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Comic Book Narrative Charts  </title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="stylesheet" type="text/css" media="all" href="http://csclub.uwaterloo.ca/~n2iskand/wp-content/themes/mytheme/style.css" />
<link rel="pingback" href="http://csclub.uwaterloo.ca/~n2iskand/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://csclub.uwaterloo.ca/~n2iskand/wp-content/themes/toolbox/js/html5.js" type="text/javascript"></script>
<![endif]-->

<link rel="alternate" type="application/rss+xml" title="Nancy Iskander &raquo; Feed" href="http://csclub.uwaterloo.ca/~n2iskand/?feed=rss2" />
<link rel="alternate" type="application/rss+xml" title="Nancy Iskander &raquo; Comments Feed" href="http://csclub.uwaterloo.ca/~n2iskand/?feed=comments-rss2" />
<link rel="alternate" type="application/rss+xml" title="Nancy Iskander &raquo; Comic Book Narrative Charts Comments Feed" href="http://csclub.uwaterloo.ca/~n2iskand/?feed=rss2&#038;page_id=13" />
<script type='text/javascript' src='http://csclub.uwaterloo.ca/~n2iskand/wp-includes/js/comment-reply.min.js?ver=3.5.1'></script>
<script type='text/javascript' src='http://csclub.uwaterloo.ca/~n2iskand/wp-includes/js/jquery/jquery.js?ver=1.8.3'></script>
<script type='text/javascript' src='http://csclub.uwaterloo.ca/~n2iskand/wp-content/plugins/google-analyticator/external-tracking.min.js?ver=6.4.4.3'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="http://csclub.uwaterloo.ca/~n2iskand/xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="http://csclub.uwaterloo.ca/~n2iskand/wp-includes/wlwmanifest.xml" /> 
<link rel='next' title='Contact' href='http://csclub.uwaterloo.ca/~n2iskand/?page_id=247' />
<meta name="generator" content="WordPress 3.5.1" />
<link rel='canonical' href='http://csclub.uwaterloo.ca/~n2iskand/?page_id=13' />
	<style type="text/css">.recentcomments a{display:inline !important;padding:0 !important;margin:0 !important;}</style>
<!-- Google Analytics Tracking by Google Analyticator 6.4.4.3: http://www.videousermanuals.com/google-analyticator/ -->
<script type="text/javascript">
	var analyticsFileTypes = [''];
	var analyticsEventTracking = 'enabled';
</script>
<script type="text/javascript">
	var _gaq = _gaq || [];
	_gaq.push(['_setAccount', 'UA-41576881-1']);
        _gaq.push(['_addDevId', 'i9k95']); // Google Analyticator App ID with Google 
        
	_gaq.push(['_trackPageview']);

	(function() {
		var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
		ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
		var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	})();
</script>

<style>
@import url('comics/narrative/narrative.css');
</style>

<script src='comics/catxml.js'></script>
<script src='comics/d3.v3.js'></script>
<script src='comics/narrative/narrative.js'></script>

</head>

<body class="page page-id-13 page-template page-template-page-cgl-narrative-php single-author">
<div id="page" class="hfeed">
	<header id="branding" role="banner">
    	        <nav id="access" role="navigation">
			<h1 class="assistive-text section-heading">Main menu</h1>
			<div class="skip-link screen-reader-text"><a href="#content" title="Skip to content">Skip to content</a></div>

	<div class="menu-cgl-menu-container"><ul id="menu-cgl-menu" class="menu"><li id="menu-item-7" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-home menu-item-7"><a href="http://csclub.uwaterloo.ca/~n2iskand/">Nancy Iskander<span style="margin: auto 10px;">/</span></a></li>
<li id="menu-item-11" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-11"><a href="mailto:thethorne@gmail.com">Matthew Thorne<span style="margin: auto 10px;">/</span></a></li>
<li id="menu-item-9" class="menu-item menu-item-type-custom menu-item-object-custom menu-item-9"><a href="http://www.cgl.uwaterloo.ca/~csk/">Craig Kaplan<span style="margin: auto 10px;">/</span></a></li>
</ul></div>		</nav><!-- #access -->


		<hgroup>
			<h1 id="site-title">Comic Book Narrative Charts</h1>
		</hgroup>

		
	</header><!-- #branding -->

	<div id="main">
		<div id="primary" class="full-width">
			<div id="content" role="main">

				
				
<article id="post-13" class="post-13 page type-page status-publish hentry">

	<div class="entry-content">
		<div id="site-description">Automatically generating narrative charts for comic books, based on <a href="xkcd.com">xkcd</a>&#8216;s <a href="http://xkcd.com/657/">Movie Narrative Charts</a><br />
Development: Ongoing
</div>
<p id="chart">
<ul class="about-list">
<li>
<h2>Description</h2>
<p>The narrative chart is a specialized instance of a Sankey Diagram, famously used to visualize Napoleon&#8217;s invasion of Russian [<a href="http://upload.wikimedia.org/wikipedia/commons/2/29/Minard.png">link</a>].</p>
<p>If you haven&#8217;t seen the xkcd charts: &#8220;The horizontal axis is time. The vertical grouping of the lines represents which characters are together at a given time&#8221;. (Napoleon&#8217;s sankey diagram overlays a map, so the horizontal axis doesn&#8217;t exactly represent time in that case.) Hover over the grey-colored nodes for the establishing shot of that event.</p>
</li>
<li>
<h2>Details</h2>
<p><span class="par-title">Input:</span> A comic book (a collection of ordered images, each representing a page).<br />
<span class="par-title">Output:</span> Pretty charts like the ones above.</p>
<p>The parent project &#8211;an annotation tool for comic books&#8211; gives us the raw data needed to generate the charts.</p>
<ol>
<li>
<h3>The Data</h3>
<p><span>The comic book is annotated with meta-data in the annotation tool that we&#8217;re developing. For the purpose of generating narrative charts, the following are the relevant pieces of information: </span></p>
<ul class="subsublist">
<li><span class="par-title">Panel outlines:</span> The frames in each page. For comics that have a simple layout with well-defined gutters (e.g. the comics whose charts are displayed above&#8211; at the time of writing: Lucky Luke, Dr. McNinja, Tintin), this step is automated. Otherwise, the outlines are manually drawn over the panels.</li>
<li><span class="par-title">Reading order:</span> For the moment, manually specified. However, most comics (in fact, almost all of the ones encountered during development) stick to the natural reading order; left-to-right / top-to-bottom, so automating this step is definitely on the to-do list.</li>
<li><span class="par-title">Characters:</span> The characters present in each &#8220;scene&#8221; of the comic. We&#8217;ve experimented a fair bit with face-detection, and managed to achieve reasonable performance (with hit rates ranging between 0.68 and 0.93, and false alarms between 0.08 and 0.24), but more on that another day. A scene is a range of consecutive panels, and a character need only appear in one of the scene&#8217;s panels in order to be included in that scene, hence, we can be forgiving about a suboptimal hit-rate. As for the false-alarm rate: Face-detection is followed by face-recognition, and it should be unlikely for not-a-face to be recognized as the face of a specific character, so my speculation is that the false-alarms will be filed under &#8220;unknown&#8221; and manually or automatically discarded.</li>
<li><span class="par-title">Starting panels for scenes:</span> Specified manually with a &#8220;new scene&#8221; tag. This may be the one thing that would be difficult to automate. The start of a new scene will usually correlate with some other parameters, like the size of the panel relative to the other panels, the use of narration, etc, but a universal correlation (i.e. one that can be found in all comic books) may not exist.</li>
</ul>
</li>
<li>
<h3>Character Clustering</h3>
<p><span>
<p>As you can probably tell, the clustering of the characters plays the primary role in the generation of the layout.</p>
<p>The data from the annotation tool is run through a python script that goes through the comic panel by panel and calculates a co-occurrence matrix for the characters. Insignificant characters (by our definition, those appearing in less than two scenes) are discarded.</p>
<p>We&#8217;ve seen much better performance using scene-cooccurrence than panel-cooccurrence, which stands to reason; for instance, a long dialogue between two characters would imply that those characters are probably in the same group, but could give us a panel co-occurrence of zero (in the extreme case) if the panels alternately switch between characters to show the one speaking at that time.</p>
<p>The co-occurrence matrix is then normalized, converted to a distance matrix, and clustered with DBSCAN.</p>
<p></span></li>
<li>
<h3>Generating the layout</h3>
<p><span>
<p>The python script outputs a json file containing descriptions of the scenes (together with the establishing shot of each scene). Sample:</p>
<pre><code>{
    "scenes": [
        {
            "duration": 5, 
            "start": 0, 
            "chars": [ 0, 2 ], 
            "id": 0
        }, 
        {
            "duration": 22, 
            "start": 5, 
            "chars": [ 0, 16, 17, 1 ], 
            "id": 1
        }, 
        {
            "duration": 11, 
            "start": 27, 
            "chars": [ 8, 1 ], 
            "id": 2
        }
    ]
}  
</code></pre>
<p>The character definitions are read from another file (mainly because we need those for more than one thing). </p>
<p>The x-coordinates of the scene nodes are determined according to the start and duration of the scene&#8211; the real challenge is determining the y-coordinates. One goal is to position the scene nodes such that the number of link crossings is minimized. The seemingly simpler problem of one-sided crossing minimization of bipartite graphs is NP-Hard (for degrees four and higher), so an exact solution is far-fetched. Instead, we rely on heuristics developed through trial and error together with staring at the xkcd charts.</p>
<ul class="subsublist">
<li><span class="par-title">Fixed cluster positions:</span> Each cluster of characters gets its own range on the y-axis. The y-coordinate of a scene node then lies within the y-range of the median cluster of the characters appearing in the scene. Ties are broken according to the median clusters of the scenes from which the links are incoming.</li>
<li><span class="par-title">Cluster sorting:</span> For now, the clusters are sorted such that the densest ones are as far away from each other as possible (in order to avoid cluttering and maximize utilization of the space available). Ideally, we&#8217;d cluster the clusters and base the ordering on that (also on the to-do list).   </li>
<li><span class="par-title">Scene positions within the cluster:</span> Within the y-range of a cluster, each character that appears in a scene whose median cluster is that cluster gets a unique y-position. Now, there are several ways to go about determining the exact position of the node within the cluster&#8217;s y-range. We could average the cluster-positions of the characters appearing in it (i.e. the positions of the characters within that cluster), or apply the heuristic we initially used to determine the y-range on a smaller scale. Both of these ideas resulted in ugly cluttering, which in retrospect should&#8217;ve been expected&#8211; what&#8217;s common to all the scenes placed in cluster x&#8217;s range is that they&#8217;re all dominated by characters from cluster x. Therefore, when we take into account the within-cluster positions of every character in the scene, they all end up getting placed at approximately the same y-position, causing ugliness. Currently, we&#8217;re averaging the positions of all the non-x-cluster characters in the scene if any exist, and of the x-cluster characters otherwise. </li>
</ul>
<p>The above is handled by a javascript file that reads the json from the python script, and draws the chart with <a href="http://d3js.org">d3</a> (which is just the best!)<br />
</span></li>
</ol>
</li>
</ul>
					</div><!-- .entry-content -->
</article><!-- #post-13 -->

					<div id="comments">
	
	
	
	
									<div id="respond">
				<h3 id="reply-title">Leave a Reply <small><a rel="nofollow" id="cancel-comment-reply-link" href="/~n2iskand/?page_id=13#respond" style="display:none;">Cancel reply</a></small></h3>
									<form action="http://csclub.uwaterloo.ca/~n2iskand/wp-comments-post.php" method="post" id="commentform">
																			<p class="comment-notes">Your email address will not be published. Required fields are marked <span class="required">*</span></p>							<p class="comment-form-author"><label for="author">Name <span class="required">*</span></label> <input id="author" name="author" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-email"><label for="email">Email <span class="required">*</span></label> <input id="email" name="email" type="text" value="" size="30" aria-required='true' /></p>
<p class="comment-form-url"><label for="url">Website</label><input id="url" name="url" type="text" value="" size="30" /></p>
												<p class="comment-form-comment"><label for="comment">Comment</label><textarea id="comment" name="comment" cols="45" rows="8" aria-required="true"></textarea></p>						<p class="form-allowed-tags">You may use these <abbr title="HyperText Markup Language">HTML</abbr> tags and attributes:  <code>&lt;a href=&quot;&quot; title=&quot;&quot;&gt; &lt;abbr title=&quot;&quot;&gt; &lt;acronym title=&quot;&quot;&gt; &lt;b&gt; &lt;blockquote cite=&quot;&quot;&gt; &lt;cite&gt; &lt;code&gt; &lt;del datetime=&quot;&quot;&gt; &lt;em&gt; &lt;i&gt; &lt;q cite=&quot;&quot;&gt; &lt;strike&gt; &lt;strong&gt; </code></p>						<p class="form-submit">
							<input name="submit" type="submit" id="submit" value="Post Comment" />
							<input type='hidden' name='comment_post_ID' value='13' id='comment_post_ID' />
<input type='hidden' name='comment_parent' id='comment_parent' value='0' />
						</p>
											</form>
							</div><!-- #respond -->
						
</div><!-- #comments -->

				
			</div><!-- #content -->
		</div><!-- #primary -->


	</div><!-- #main -->

	<footer id="colophon" role="contentinfo">
		<div id="site-generator">
			Copyright &copy; 2013 Nancy Iskander 
		</div>
	</footer><!-- #colophon -->
</div><!-- #page -->


</body>
</html>